@model Terz.Models.User.ReportModel



<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Terz | Admin</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="~/terz/LTE/plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="~/terz/LTE/plugins/fontawesome-free/css/all.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="~/terz/LTE/dist/css/adminlte.min.css">
    <link  rel="stylesheet" href="~/terz/css/ReportPage.css"/>
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
    <script src="~/admin/js/Grammar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>


</head>
<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>

            </ul>

            <!-- SEARCH FORM -->
            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <!-- Messages Dropdown Menu -->
                <li class="nav-item dropdown">
                    <a class="nav-link" href="@Url.Action("Index","Creditos")">
                        <i class="fas fa-dollar-sign"></i>
                        @Model.Usuario.Creditos Créditos
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" href="#">
                        <i class="fas fa-sign-out-alt"></i>
                        Sair
                    </a>
                </li>
                <!-- Notifications Dropdown Menu -->

                <li class="nav-item">
                    <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
                        <i class="fas fa-th-large"></i>
                    </a>
                </li>
            </ul>
        </nav>
        <!-- /.navbar -->
        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <!-- Brand Logo -->
            <a href="#" class="brand-link">
                <img src="~/terz/images/Terz_Logo.png"
                     alt="Terz Logo"
                     class="brand-image img-circle elevation-3"
                     style="opacity: .8">
                <span class="brand-text font-weight-light">TERZ</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">


                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                        <!-- Add icons to the links using the .nav-icon class
    with font-awesome or any other icon font library -->


                        <li class="nav-item has-treeview">
                            <a href="@Url.Action("UserPage","User")" class="nav-link">
                                <i class="fas fa-tachometer-alt"></i>
                                <p>
                                    DashBoard

                                </p>
                            </a>

                        </li>
                        <li class="nav-item has-treeview">
                            <a href="@Url.Action("Report","User")" class="nav-link">
                                <i class="fas fa-chart-area"></i>
                                <p>
                                    Meus Relatórios

                                </p>
                            </a>

                        </li>

                        <li class="nav-item has-treeview">
                            <a href="@Url.Action("Perfil","User")" class="nav-link">
                                <i class="fas fa-user"></i>
                                <p>
                                    Perfil

                                </p>
                            </a>

                        </li>
                        <li class="nav-item has-treeview">
                            <a href="@Url.Action("Index","Creditos")" class="nav-link">
                                <i class="far fa-money-bill-alt"></i>
                                <p>
                                    Comprar Créditos

                                </p>
                            </a>

                        </li>




                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>
        <div class="content-wrapper" id="Conteudo" style="padding-left:10px">
            <button class="ButtonNovo" onclick="novoRelatorio()">Novo Relatório</button>
            <button class="ButtonNovo" onclick="importarRelatorio()">Importar Relatório</button>

            @foreach (Terz_DataBaseLayer.Report report in Model.Usuario.Reports)
            {
            <div class="ReportDiv">


                @if (report.Imagem == "" || report.Imagem == null)
                {
                    <img onclick="EditReport('@report.Id')" width="130" height="100" class="FotoPerfil" src="~/terz/images/app.png" />
                }
                else
                {
                    <img onclick="EditReport('@report.Id')" width="130" height="100" class="FotoPerfil" src="@report.Imagem" />
                }
                <label style="width:200px" class="LabelDesc">@report.Titulo</label>
                <label style="margin-left:16px; font-size:22px"><a href="../Editor?id=@report.Id"><i class="fa fa-edit"></i></a></label>
                <label style="margin-left:16px; font-size:22px"><a href="../DataManager?id=@report.Id"><i class="fas fa-table"></i> </a></label>
                <label style="margin-left:16px; font-size:22px"><a href="../Report?id=@report.Id"><i class="fas fa-eye"></i></a></label>
                <label style="margin-left:16px; font-size:22px"><a href="../User/ExportApp?id=@report.Id"><i class="fas fa-download"></i></a></label>
                @if (report.Ativo == 1)
                {
                    <label style="margin-left:100px; font-size:26px"><a href="#" onclick="desativarRelatorio(@report.Id)"><i class="fas fa-toggle-on"></i></a></label>
                }
                else
                {
                    <label style="margin-left:100px; font-size:26px"><a href="#" onclick="ativarRelatorio(@report.Id)"><i class="fas fa-toggle-off"></i></a></label>
                }





            </div>
            }


            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
            <script>


                function ativarRelatorio(id) {
                    $.ajax(
                        {
                            type: 'POST',
                            url: '../User/AtivarReport?id=' + id ,
                            dataType: 'html',
                            cache: false,
                            async: true,

                            success: function (data) {
                                alert(data);
                                location.reload();

                            },

                        });
                }

                function desativarRelatorio(id) {
                    $.ajax(
                        {
                            type: 'POST',
                            url: '../User/DesativarReport?id=' + id,
                            dataType: 'html',
                            cache: false,
                            async: true,

                            success: function (data) {
                                alert(data);
                                location.reload();

                            },

                        });
                }


                function importarRelatorio() {
                    var form;
                    $.ajax(
                        {
                            type: 'POST',
                            url: '../User/ImportReport',
                            dataType: 'html',
                            cache: false,
                            async: true,

                            success: function (data) {
                                form = data;
                                bootbox.confirm(form, function (result) {
                                    if (result)

                                        var title = document.getElementById("Title").value;
                                    var category = document.getElementById("category").value;
                                    criarRelatorioImportado(title, category);

                                });

                            },


                        });
                }

                function EditReport(id) {
                    var form;
                    $.ajax(
                        {
                            type: 'POST',
                            url: '../User/ReportEditorConfig?id=' + id,
                            dataType: 'html',
                            cache: false,
                            async: true,

                            success: function (data) {
                                form = data;
                                bootbox.confirm(form, function (result) {
                                    if (result) {
                                        var name = document.getElementById("appName").value;
                                        AtualizarRelatorio(id, name);
                                    }

                                });

                            },


                        });
                }

                function AtualizarRelatorio(id, name) {
                    var formData = new FormData();
                    var file = document.getElementById("ImagemApp").files[0];
                    formData.append("ImagemApp", file);
                    $.ajax(
                        {
                            type: 'POST',
                            url: '../User/UpdateReportAsync?id=' + id + '&name=' + name,
                            dataType: 'html',
                            cache: false,
                            async: true,
                            contentType: false,
                            processData: false,
                            data: formData,
                            success: function (data) {
                                form = data;
                                bootbox.confirm(form, function (result) {
                                    if (result)

                                        location.reload();

                                });

                            },



                        });

                }

                function novoRelatorio() {
                    var form;
                    $.ajax(
                        {
                            type: 'POST',
                            url: '../User/AddReport',
                            dataType: 'html',
                            cache: false,
                            async: true,

                            success: function (data) {
                                form = data;
                                bootbox.confirm(form, function (result) {
                                    if (result)

                                        var title = document.getElementById("Title").value;
                                    var category = document.getElementById("category").value;
                                    criarRelatorio(title, category);

                                });

                            },


                        });
                }

                function criarRelatorio(title, category) {
                    $.ajax(
                        {
                            type: 'POST',
                            url: '../Report/CreateReport?title=' + title + '&category=' + category,
                            dataType: 'html',
                            cache: false,
                            async: true,

                            success: function (data) {
                                form = data;
                                bootbox.confirm(form, function (result) {
                                    if (result)

                                        location.reload();

                                });

                            },

                        });
                }

                function criarRelatorioImportado(title, category) {

                    var formData = new FormData();
                    var file = document.getElementById("reportConfig").files[0];
                    formData.append("reportConfig", file);
                    $.ajax(
                        {
                            type: 'POST',
                            url: '../Report/ImportReport?title=' + title + '&category=' + category,
                            dataType: 'html',
                            contentType: false,
                            processData: false,
                            cache: false,
                            async: true,

                            success: function (data) {
                                form = data;
                                bootbox.confirm(form, function (result) {
                                    if (result)

                                        location.reload();

                                });

                            },
                            data: formData

                        });
                }
            </script>


        </div>

        <footer class="main-footer">
            <div class="float-right d-none d-sm-block">
                <b>Version</b> 1.0
            </div>

        </footer>

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->
    <!-- jQuery -->
    <script src="~/terz/LTE/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="~/terz/LTE/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- AdminLTE App -->
    <script src="~/terz/LTE/dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="~/terz/LTE/dist/js/demo.js"></script>
</body>
</html>